<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Computer Hardware Assembly Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            margin: 0;
            padding: 20px;
            user-select: none;
        }

        h1 {
            text-align: center;
            color: #333;
        }

        .game-container {
            display: flex;
            flex-direction: column;
            max-width: 1000px;
            margin: 0 auto;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 20px;
            position: relative;
            /* Needed for fireworks if placed inside */
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .score-timer-container {
            display: flex;
            gap: 20px;
        }

        .score,
        .timer {
            font-size: 1.2rem;
            font-weight: bold;
        }

        .timer {
            color: #333;
            transition: color 0.5s ease-in-out;
        }

        .timer.warning {
            animation: pulse-warning 1s infinite;
        }

        @keyframes pulse-warning {
            0% {
                color: #d9534f;
                transform: scale(1);
            }

            50% {
                color: #ff0000;
                transform: scale(1.05);
            }

            100% {
                color: #d9534f;
                transform: scale(1);
            }
        }

        .game-area {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }

        .ram-module {
            transform: rotate(90deg);
        }

        .parts-container {
            flex: 1;
            min-width: 300px;
            padding: 15px;
            background-color: #e9f5ff;
            border-radius: 8px;
            border: 2px dashed #5a9ad6;
        }

        .motherboard-container {
            flex: 2;
            min-width: 450px;
            position: relative;
            height: 500px;
            background-image: url('./mobo.png');
            background-size: cover;
            background-position: center;
            border-radius: 8px;
            padding: 15px;
            overflow: hidden;
        }

        .part {
            width: 80px;
            height: 80px;
            margin: 10px;
            cursor: grab;
            border-radius: 5px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            text-align: center;
            font-size: 12px;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            position: relative;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            /* Add transition for smooth dragging effect */
        }

        .part-label {
            position: absolute;
            bottom: -20px;
            left: 0;
            right: 0;
            text-align: center;
            color: #333;
            font-size: 12px;
            font-weight: bold;
            text-shadow: 1px 1px 1px white;
        }

        .part.dragging {
            opacity: 0.9;
            /* Slightly less opaque */
            transform: scale(1.1);
            /* Scale up slightly when dragging */
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
            /* More prominent shadow */
            cursor: grabbing;
            z-index: 10;
            /* Bring dragged item to front */
        }


        .drop-zone {
            position: absolute;
            border: 2px dashed #666;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 12px;
            text-align: center;
            background-color: rgba(0, 0, 0, 0.3);
            z-index: 1;
        }

        .drop-zone.highlight {
            border-color: #4CAF50;
            background-color: rgba(76, 175, 80, 0.4);
            /* Slightly more opaque highlight */
        }

        .drop-zone.filled {
            border-style: solid;
            border-color: #4CAF50;
            background-color: transparent;
        }

        .drop-zone.filled .part {
            position: static !important;
            /* Override absolute positioning */
            width: 100% !important;
            height: 100% !important;
            margin: 0 !important;
            transform: none !important;
            /* Remove any transform */
        }

        /* Drop Feedback Animations */
        .drop-zone.correct-drop {
            animation: correct-flash 0.5s ease-out;
        }

        @keyframes correct-flash {
            0% {
                border-color: #4CAF50;
                background-color: rgba(76, 175, 80, 0.4);
            }

            50% {
                border-color: #8bc34a;
                background-color: rgba(139, 195, 74, 0.6);
            }

            /* Brighter green flash */
            100% {
                border-color: #4CAF50;
                background-color: transparent;
            }
        }

        .drop-zone.wrong-drop {
            animation: shake-red 0.5s ease-in-out;
            border-color: #d9534f !important;
            /* Keep red during shake */
        }

        @keyframes shake-red {
            0% {
                transform: translateX(0);
            }

            20% {
                transform: translateX(-5px);
            }

            40% {
                transform: translateX(5px);
            }

            60% {
                transform: translateX(-5px);
            }

            80% {
                transform: translateX(5px);
            }

            100% {
                transform: translateX(0);
            }
        }


        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 100;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            text-align: center;
            max-width: 500px;
        }

        .modal h2 {
            margin-top: 0;
        }

        .bonus-score {
            color: #4CAF50;
            font-weight: bold;
        }

        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            text-align: center;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer;
            border-radius: 4px;
        }

        button:hover {
            background-color: #45a049;
        }

        .tooltip {
            position: absolute;
            background-color: #333;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            z-index: 10;
            display: none;
            pointer-events: none;
        }

        .help-btn {
            background-color: #5a9ad6;
            margin-left: 10px;
        }

        .reset-btn {
            background-color: #f44336;
        }

        .info-panel {
            margin-top: 20px;
            padding: 15px;
            background-color: #f5f5f5;
            border-radius: 8px;
            display: none;
        }

        .info-panel h3 {
            margin-top: 0;
        }

        /* Fireworks Container and Spark Styling */
        #fireworks-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            /* Allow interaction behind fireworks */
            z-index: 99;
            /* Below the modal but above everything else */
        }

        .spark {
            position: absolute;
            width: 5px;
            height: 5px;
            border-radius: 50%;
            background-color: #fff;
            /* Default color, will be randomized */
        }

        /* Spark Burst Animation (defined dynamically in JS) */
        /* Example Keyframes (actual values set in JS)
         @keyframes spark-burst {
             0% { transform: translate(0, 0) scale(1); opacity: 1; }
             100% { transform: translate(Xpx, Ypx) scale(0); opacity: 0; }
         }
         */
    </style>
</head>

<body>
    <div class="game-container">
        <h1>Computer Hardware Assembly Game</h1>

        <div class="game-header">
            <div class="score-timer-container">
                <div class="score">Score: <span id="score">0</span></div>
                <div class="timer">Time: <span id="timer">01:00</span></div>
            </div>
            <div>
                <button id="help-btn" class="help-btn">Show Help</button>
                <button id="reset-btn" class="reset-btn">Reset Game</button>
            </div>
        </div>

        <div class="game-area">
            <div class="parts-container" id="parts-container">
                <h3>Available Components</h3>
            </div>

            <div class="motherboard-container" id="motherboard-container">
            </div>
        </div>

        <div class="info-panel" id="info-panel">
            <h3>How to Play</h3>
            <p>Drag each computer component from the left panel and drop it into its correct position on the
                motherboard.</p>
            <p>Each correct placement earns you points. Try to place all components correctly!</p>
            <p><strong>Time Bonus:</strong> Complete the assembly faster to earn more bonus points! You have 1 minute.
            </p>
            <h3>Components Information:</h3>
            <ul>
                <li><strong>CPU</strong>: The brain of the computer that processes instructions.</li>
                <li><strong>RAM</strong>: Temporary memory that allows for quick data access.</li>
                <li><strong>GPU</strong>: Handles graphics processing and display output.</li>
                <li><strong>SSD</strong>: Fast storage device for the operating system and applications.</li>
                <li><strong>HDD</strong>: Larger capacity storage for files and data.</li>
                <li><strong>PSU</strong>: Power supply unit that provides electricity to all components.</li>
                <li><strong>CPU Fan</strong>: Keeps the processor cool during operation.</li>
                <li><strong>Network Card</strong>: Enables internet and local network connections.</li>
            </ul>
        </div>
    </div>

    <div id="tooltip" class="tooltip"></div>
    <div id="fireworks-container"></div>
    <div id="completion-modal" class="modal">
        <div class="modal-content">
            <h2>Congratulations!</h2>
            <p>You've correctly assembled all the computer hardware components!</p>
            <p>Component Score: <span id="component-score">0</span></p>
            <p>Time Bonus: <span id="bonus-score" class="bonus-score">0</span></p>
            <p>Final Score: <span id="final-score">0</span></p>
            <button id="play-again-btn">Play Again</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Game state
            let score = 0;
            let correctPlacements = 0;
            let totalParts = 0;
            let timeLeft = 60; // 1 minute in seconds
            let timerInterval;
            let timeBonus = 0;
            let gameActive = false;

            // Elements
            const partsContainer = document.getElementById('parts-container');
            const motherboardContainer = document.getElementById('motherboard-container');
            const scoreElement = document.getElementById('score');
            const timerElement = document.getElementById('timer');
            const timerContainer = timerElement.parentElement; // Get the parent div for the warning class
            const tooltip = document.getElementById('tooltip');
            const modal = document.getElementById('completion-modal');
            const finalScoreElement = document.getElementById('final-score');
            const componentScoreElement = document.getElementById('component-score');
            const bonusScoreElement = document.getElementById('bonus-score');
            const playAgainBtn = document.getElementById('play-again-btn');
            const helpBtn = document.getElementById('help-btn');
            const resetBtn = document.getElementById('reset-btn');
            const infoPanel = document.getElementById('info-panel');
            const fireworksContainer = document.getElementById('fireworks-container');


            // Components data with images
            const components = [
                {
                    id: 'cpu',
                    name: 'CPU',
                    image: './cpu.webp',
                    correctZone: 'cpu-zone',
                    points: 10,
                    description: 'Central Processing Unit - The brain of the computer'
                },
                {
                    id: 'ram1',
                    name: 'RAM',
                    image: './ram.png',
                    correctZone: 'ram1-zone',
                    points: 5,
                    description: 'Random Access Memory - For temporary data storage'
                },
                {
                    id: 'ram2',
                    name: 'RAM',
                    image: './ram.png',
                    correctZone: 'ram2-zone',
                    points: 5,
                    description: 'Random Access Memory - For temporary data storage'
                },
                {
                    id: 'gpu',
                    name: 'GPU',
                    image: './gpu.jpg',
                    correctZone: 'gpu-zone',
                    points: 15,
                    description: 'Graphics Processing Unit - Handles visual output'
                },
                {
                    id: 'ssd',
                    name: 'SSD',
                    image: './ssd.jpg',
                    correctZone: 'ssd-zone',
                    points: 8,
                    description: 'Solid State Drive - Fast storage device'
                },
                {
                    id: 'hdd',
                    name: 'HDD',
                    image: './hdd.jpg',
                    correctZone: 'hdd-zone',
                    points: 7,
                    description: 'Hard Disk Drive - Larger capacity storage'
                },
                {
                    id: 'psu',
                    name: 'Power Supply',
                    image: './psu.webp',
                    correctZone: 'psu-zone',
                    points: 12,
                    description: 'Power Supply Unit - Provides electricity to components'
                },
                {
                    id: 'fan',
                    name: 'CPU Fan',
                    image: './fan.jpg',
                    correctZone: 'fan-zone',
                    points: 6,
                    description: 'CPU Cooling Fan - Prevents overheating'
                },
                {
                    id: 'network',
                    name: 'Network Card',
                    image: './wifi_card.jpg',
                    correctZone: 'network-zone',
                    points: 8,
                    description: 'Network Interface Card - For internet connectivity'
                }
            ];

            // Drop zones with positions (keep this here as it's used by createDropZones)
            const dropZones = [
                { id: 'cpu-zone', name: 'CPU Socket', left: '42%', top: '25%', width: '80px', height: '80px' },
                { id: 'ram1-zone', name: 'RAM Slot 1', left: '65%', top: '15%', width: '40px', height: '120px' },
                { id: 'ram2-zone', name: 'RAM Slot 2', left: '70%', top: '15%', width: '40px', height: '120px' },
                { id: 'gpu-zone', name: 'PCIe x16 Slot', left: '28%', top: '63%', width: '180px', height: '40px' },
                { id: 'ssd-zone', name: 'M.2 Slot', left: '30%', top: '50%', width: '80px', height: '30px' },
                { id: 'hdd-zone', name: 'SATA Port', left: '15%', top: '55%', width: '60px', height: '40px' },
                { id: 'psu-zone', name: 'Power Supply Area', left: '80%', top: '75%', width: '100px', height: '100px' },
                { id: 'fan-zone', name: 'CPU Fan Mount', left: '42%', top: '10%', width: '80px', height: '80px' },
                { id: 'network-zone', name: 'PCIe x1 Slot', left: '18%', top: '74%', width: '120px', height: '30px' }
            ];


            totalParts = components.length;

            // Timer functions
            function startTimer() {
                gameActive = true;
                clearInterval(timerInterval); // Clear any existing timer
                timerInterval = setInterval(() => {
                    timeLeft--;
                    updateTimerDisplay();

                    // Add warning class when time is running low (15 seconds or less)
                    if (timeLeft <= 15 && !timerContainer.classList.contains('warning')) {
                        timerContainer.classList.add('warning');
                    } else if (timeLeft > 15 && timerContainer.classList.contains('warning')) {
                        timerContainer.classList.remove('warning');
                    }


                    if (timeLeft <= 0) {
                        endGame();
                    }
                }, 1000);
            }

            function updateTimerDisplay() {
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }

            function endGame() {
                clearInterval(timerInterval);
                gameActive = false;
                timerContainer.classList.remove('warning'); // Ensure animation stops

                if (correctPlacements === totalParts) {
                    // Completion handled by checkCompletion
                } else {
                    showTimeOutModal();
                }
            }

            function showTimeOutModal() {
                const modal = document.getElementById('completion-modal');
                const modalContent = modal.querySelector('.modal-content');
                modalContent.innerHTML = `
                    <h2>Time's Up!</h2>
                    <p>You placed ${correctPlacements} out of ${totalParts} components correctly.</p>
                    <p>Score: ${score}</p>
                    <button id="play-again-btn">Play Again</button>
                `;

                // Re-attach event listener
                document.getElementById('play-again-btn').addEventListener('click', resetGame);

                modal.style.display = 'flex';
            }


            function calculateTimeBonus() {
                return Math.round((timeLeft / 60) * 100);
            }

            // Create drop zones
            function createDropZones() {
                dropZones.forEach(zone => {
                    const dropZone = document.createElement('div');
                    dropZone.id = zone.id;
                    dropZone.className = 'drop-zone';
                    dropZone.style.left = zone.left;
                    dropZone.style.top = zone.top;
                    dropZone.style.width = zone.width;
                    dropZone.style.height = zone.height;
                    dropZone.textContent = zone.name;

                    dropZone.addEventListener('dragover', e => {
                        e.preventDefault();
                        // Only highlight if a draggable item is being held
                        const draggedPartId = e.dataTransfer.types.includes('text/plain') ? e.dataTransfer.getData('text/plain') : null;
                        if (draggedPartId && document.getElementById(draggedPartId)) {
                            dropZone.classList.add('highlight');
                        }
                    });

                    dropZone.addEventListener('dragleave', () => {
                        dropZone.classList.remove('highlight');
                    });

                    dropZone.addEventListener('drop', e => {
                        e.preventDefault();
                        dropZone.classList.remove('highlight');

                        if (!gameActive) {
                            startTimer();
                        }

                        const partId = e.dataTransfer.getData('text/plain');
                        const part = document.getElementById(partId);
                        const component = components.find(c => c.id === partId);

                        // Prevent dropping on a filled zone or if the part is invalid
                        if (dropZone.classList.contains('filled') || !part || !component) {
                            // Optional: visual feedback for dropping on filled zone
                            if (dropZone.classList.contains('filled')) {
                                dropZone.classList.add('wrong-drop');
                                setTimeout(() => dropZone.classList.remove('wrong-drop'), 500);
                            }
                            // Return the dragged item to the parts container if it was removed
                            if (part && !partsContainer.contains(part) && !dropZone.contains(part)) {
                                resetPartToContainer(part, component);
                            }
                            return;
                        }

                        // Special handling for RAM modules
                        if ((component.id === 'ram1' || component.id === 'ram2') &&
                            (zone.id === 'ram1-zone' || zone.id === 'ram2-zone')) {
                            // This is a RAM module being dropped on a RAM slot
                            // Consider this a correct placement

                            // Remove the part from the parts container
                            if (partsContainer.contains(part)) {
                                partsContainer.removeChild(part);
                            }

                            // Append the part to the drop zone
                            dropZone.innerHTML = ''; // Clear text content
                            dropZone.appendChild(part);
                            dropZone.classList.add('filled');

                            // Adjust part styles for placement
                            part.style.position = 'static'; // Position relative to drop zone
                            part.style.width = '100%';
                            part.style.height = '100%';
                            part.style.margin = '0';
                            part.style.cursor = 'default';
                            part.setAttribute('draggable', 'false');
                            part.style.transform = 'none'; // Remove any rotation or scale

                            const label = part.querySelector('.part-label');
                            if (label) {
                                label.style.display = 'none';
                            }

                            // Add correct drop animation
                            dropZone.classList.add('correct-drop');
                            setTimeout(() => dropZone.classList.remove('correct-drop'), 500);

                            // Update score
                            score += component.points;
                            scoreElement.textContent = score;

                            // Check if game is complete
                            correctPlacements++;
                            checkCompletion();
                        }
                        else if (component.correctZone === zone.id) {
                            // All other components follow the original logic
                            // Remove the part from the parts container
                            partsContainer.removeChild(part);

                            // Append the part to the drop zone
                            dropZone.innerHTML = ''; // Clear text content
                            dropZone.appendChild(part);
                            dropZone.classList.add('filled');

                            // Adjust part styles for placement
                            part.style.position = 'static'; // Position relative to drop zone
                            part.style.width = '100%';
                            part.style.height = '100%';
                            part.style.margin = '0';
                            part.style.cursor = 'default';
                            part.setAttribute('draggable', 'false');
                            part.style.transform = 'none'; // Remove any rotation or scale

                            const label = part.querySelector('.part-label');
                            if (label) {
                                label.style.display = 'none';
                            }

                            // Add correct drop animation
                            dropZone.classList.add('correct-drop');
                            setTimeout(() => dropZone.classList.remove('correct-drop'), 500);

                            // Update score
                            score += component.points;
                            scoreElement.textContent = score;

                            // Check if game is complete
                            correctPlacements++;
                            checkCompletion();
                        } else {
                            // Wrong placement
                            // Add wrong drop animation
                            dropZone.classList.add('wrong-drop');
                            setTimeout(() => dropZone.classList.remove('wrong-drop'), 500);

                            // Return the part to the parts container
                            if (part) {
                                resetPartToContainer(part, component);
                            }

                            // Optional: Small penalty
                            if (score > 0) {
                                score -= 1;
                                scoreElement.textContent = score;
                            }
                        }
                    });

                    motherboardContainer.appendChild(dropZone);
                });
            }

            // Helper to return part to original container with correct styles
            function resetPartToContainer(part, component) {
                // Only attempt to reset if the part element still exists
                if (part) {
                    part.style.position = 'relative'; // Default position in flow
                    part.style.margin = '10px';       // Restore original margin
                    part.style.width = '80px';        // Restore original width
                    part.style.height = '80px';       // Restore original height
                    part.style.cursor = 'grab';       // Restore grab cursor
                    part.setAttribute('draggable', 'true'); // Make it draggable again
                    part.classList.remove('dragging'); // Ensure dragging class is removed

                    // Ensure the label is visible again
                    const label = part.querySelector('.part-label');
                    if (label) {
                        label.style.display = ''; // Reset display property
                    }

                    // Reset/reapply specific styles like rotation for RAM
                    if (component && (component.id === 'ram1' || component.id === 'ram2')) {
                        part.style.transform = 'rotate(90deg)'; // Re-apply rotation
                        part.classList.add('ram-module'); // Ensure class is there
                    } else {
                        part.style.transform = 'none'; // Remove any potential transform
                        part.classList.remove('ram-module'); // Ensure class isn't there
                    }

                    // Append the element back to the parts container
                    partsContainer.appendChild(part);
                }
            }


            function checkCompletion() {
                if (correctPlacements === totalParts) {
                    clearInterval(timerInterval);
                    gameActive = false;
                    timerContainer.classList.remove('warning');

                    timeBonus = calculateTimeBonus();
                    const finalScore = score + timeBonus;

                    componentScoreElement.textContent = score;
                    bonusScoreElement.textContent = timeBonus;
                    finalScoreElement.textContent = finalScore;

                    // Launch fireworks slightly before showing the modal
                    setTimeout(() => {
                        launchFireworks(5); // Launch 5 bursts
                    }, 300); // Short delay


                    // Show modal after a short delay
                    setTimeout(() => {
                        modal.style.display = 'flex';
                    }, 1500); // Show modal after fireworks start


                }
            }

            // Create a component element
            function createComponentElement(component) {
                const part = document.createElement('div');
                part.id = component.id;
                part.className = 'part';
                part.style.backgroundImage = `url('${component.image}')`;
                part.setAttribute('draggable', 'true');
                part.dataset.description = component.description;

                // Add label
                const label = document.createElement('div');
                label.className = 'part-label';
                label.textContent = component.name;
                part.appendChild(label);

                setupDraggable(part);
                partsContainer.appendChild(part);

                // Add rotation class to RAM modules
                if (component.id === 'ram1' || component.id === 'ram2') {
                    part.classList.add('ram-module');
                }

                return part;
            }

            // Create components
            function createComponents() {
                const shuffledComponents = components.sort(() => Math.random() - 0.5);
                shuffledComponents.forEach(component => {
                    createComponentElement(component);
                });
            }

            // Setup draggable behavior
            function setupDraggable(element) {
                element.addEventListener('dragstart', e => {
                    if (!gameActive) {
                        startTimer();
                    }

                    e.dataTransfer.setData('text/plain', element.id);
                    element.classList.add('dragging');
                    hideTooltip();
                    // For Firefox, set a drag image if the default isn't great
                    if ('setDragImage' in e.dataTransfer) {
                        const img = new Image();
                        img.src = component.image; // Use the component image for the drag image
                        e.dataTransfer.setDragImage(img, element.offsetWidth / 2, element.offsetHeight / 2);
                    }
                });

                element.addEventListener('dragend', e => {
                    element.classList.remove('dragging');

                    // If the drag ended without a drop (e.g., dropped outside valid zone),
                    // ensure the part is still in the parts container.
                    // This is largely handled by the drop logic, but this is a fallback.
                    const partId = element.id;
                    const component = components.find(c => c.id === partId);
                    const isInPartsContainer = partsContainer.contains(element);
                    const isPlaced = document.querySelector(`.drop-zone.filled #${partId}`);

                    if (!isInPartsContainer && !isPlaced) {
                        // If it's neither in the parts container nor correctly placed,
                        // it was likely dragged and dropped somewhere invalid.
                        // Put it back in the parts container.
                        resetPartToContainer(element, component);
                    }


                });


                // Tooltip functionality
                element.addEventListener('mouseover', e => {
                    // Check if the element is not currently being dragged
                    if (!element.classList.contains('dragging')) {
                        showTooltip(element.dataset.description, e.clientX, e.clientY);
                    }
                });

                element.addEventListener('mousemove', e => {
                    if (tooltip.style.display === 'block') { // Only update position if tooltip is visible
                        updateTooltipPosition(e.clientX, e.clientY);
                    }
                });

                element.addEventListener('mouseout', () => {
                    hideTooltip();
                });

                element.addEventListener('touchstart', hideTooltip);
                element.addEventListener('touchmove', hideTooltip); // Hide on touch move too
            }

            // Tooltip functions (keep the existing functions)
            function showTooltip(text, x, y) {
                tooltip.textContent = text;
                tooltip.style.display = 'block';
                updateTooltipPosition(x, y);
            }

            function updateTooltipPosition(x, y) {
                const tooltipWidth = tooltip.offsetWidth;
                const tooltipHeight = tooltip.offsetHeight;
                const viewportWidth = window.innerWidth;
                const viewportHeight = window.innerHeight;

                let newX = x + 15;
                let newY = y + 15;

                if (newX + tooltipWidth > viewportWidth) {
                    newX = x - tooltipWidth - 15;
                }
                if (newY + tooltipHeight > viewportHeight) {
                    newY = y - tooltipHeight - 15;
                }

                tooltip.style.left = newX + 'px';
                tooltip.style.top = newY + 'px';
            }

            function hideTooltip() {
                tooltip.style.display = 'none';
            }


            // Fireworks Functionality

            function createSpark(x, y, color, xEnd, yEnd) {
                const spark = document.createElement('div');
                spark.className = 'spark';
                spark.style.backgroundColor = color;
                spark.style.left = `${x}px`;
                spark.style.top = `${y}px`;

                // Define keyframes dynamically for each spark
                const sparkAnimationName = `spark-burst-${Date.now()}-${Math.random().toString(36).substr(2, 5)}`;
                const styleSheet = document.styleSheets[0];

                const keyframes = `
                     @keyframes ${sparkAnimationName} {
                         0% {
                             transform: translate(0, 0) scale(1);
                             opacity: 1;
                         }
                         100% {
                             transform: translate(${xEnd - x}px, ${yEnd - y}px) scale(0.2); /* Move and shrink */
                             opacity: 0;
                         }
                     }
                 `;
                styleSheet.insertRule(keyframes, styleSheet.cssRules.length);


                // Apply the animation
                const animationDuration = Math.random() * 0.8 + 0.7; // Duration between 0.7s and 1.5s
                const animationDelay = Math.random() * 0.3; // Small random delay

                spark.style.animation = `${sparkAnimationName} ${animationDuration}s ease-out ${animationDelay}s forwards`;

                // Remove the element and the keyframes after animation
                spark.addEventListener('animationend', () => {
                    spark.remove();
                    try {
                        // Attempt to remove the dynamically created keyframe rule
                        for (let i = 0; i < styleSheet.cssRules.length; i++) {
                            if (styleSheet.cssRules[i].name === sparkAnimationName) {
                                styleSheet.deleteRule(i);
                                break;
                            }
                        }
                    } catch (e) {
                        // Handle potential errors if deleting rule fails (e.g., cross-origin)
                        console.warn("Could not delete keyframe rule:", e);
                    }
                });

                fireworksContainer.appendChild(spark);
            }

            function launchFireworksBurst(x, y, numberOfSparks = 30) {
                const colors = ['#ff0', '#f00', '#0f0', '#00f', '#f0f', '#0ff', '#fff']; // Firework colors
                const maxDistance = 150; // Max distance sparks travel from center

                for (let i = 0; i < numberOfSparks; i++) {
                    const angle = Math.random() * Math.PI * 2; // Random angle in radians
                    const distance = Math.random() * maxDistance; // Random distance

                    const xEnd = x + distance * Math.cos(angle);
                    const yEnd = y + distance * Math.sin(angle);
                    const color = colors[Math.floor(Math.random() * colors.length)];

                    createSpark(x, y, color, xEnd, yEnd);
                }
            }

            function launchFireworks(numberOfBursts = 3) {
                const containerRect = fireworksContainer.getBoundingClientRect();
                const centerX = containerRect.left + containerRect.width / 2;
                const centerY = containerRect.top + containerRect.height / 2;

                for (let i = 0; i < numberOfBursts; i++) {
                    // Launch bursts from slightly randomized positions around the center
                    const offsetX = (Math.random() - 0.5) * containerRect.width * 0.3; // +/- 15% of container width
                    const offsetY = (Math.random() - 0.5) * containerRect.height * 0.3; // +/- 15% of container height

                    const burstX = centerX + offsetX;
                    const burstY = centerY + offsetY;


                    // Launch bursts with a small delay between them
                    setTimeout(() => {
                        launchFireworksBurst(burstX, burstY);
                    }, i * 300); // 300ms delay between bursts
                }
            }


            // Reset game
            function resetGame() {
                document.querySelectorAll('.drop-zone').forEach(zone => {
                    zone.remove();
                });

                const header = partsContainer.querySelector('h3');
                partsContainer.innerHTML = '';
                partsContainer.appendChild(header);

                score = 0;
                correctPlacements = 0;
                timeLeft = 60;
                timeBonus = 0;
                gameActive = false;

                scoreElement.textContent = score;
                updateTimerDisplay();
                timerContainer.classList.remove('warning');
                modal.style.display = 'none';

                clearInterval(timerInterval);

                // Clear any lingering sparks
                fireworksContainer.innerHTML = '';

                createDropZones();
                createComponents();
            }

            // Event listeners
            helpBtn.addEventListener('click', () => {
                if (infoPanel.style.display === 'block') {
                    infoPanel.style.display = 'none';
                    helpBtn.textContent = 'Show Help';
                } else {
                    infoPanel.style.display = 'block';
                    helpBtn.textContent = 'Hide Help';
                }
            });

            resetBtn.addEventListener('click', resetGame);
            playAgainBtn.addEventListener('click', resetGame);

            // Initialize game
            createDropZones();
            createComponents();
            updateTimerDisplay();
        });
    </script>
</body>

</html>
